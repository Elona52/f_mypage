<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.history.mapper.HistoryMapper">

    <resultMap id="historyMap" type="com.project.history.domain.HistoryEntry">
        <id property="id" column="history_id"/>
        <result property="userId" column="user_id"/>
        <result property="reservationId" column="reservation_id"/>
        <result property="tradeId" column="trade_id"/>
        <result property="action" column="action"/>
        <result property="detail" column="detail"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO history (
            user_id, reservation_id, trade_id, action, detail, created_at
        ) VALUES (
            #{userId}, #{reservationId}, #{tradeId}, #{action}, #{detail}, NOW()
        )
    </insert>

    <select id="findByUser" resultMap="historyMap">
        SELECT * FROM history WHERE user_id = #{userId} ORDER BY created_at DESC
    </select>

    <select id="findByReservation" resultMap="historyMap">
        SELECT * FROM history WHERE reservation_id = #{reservationId} ORDER BY created_at DESC
    </select>

    <select id="findByTrade" resultMap="historyMap">
        SELECT * FROM history WHERE trade_id = #{tradeId} ORDER BY created_at DESC
    </select>

</mapper>

